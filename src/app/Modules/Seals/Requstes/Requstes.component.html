<div  dir="ltr" class="mt-3">
  <p-button [raised]="true" [routerLink]="['/Main/RequstesList']" routerLinkActive="router-link-active" severity="info"
    label="Back to Reservations List" icon="pi pi-arrow-left" class=" btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
  <div class="row justify-content-center my-3">
    <div class="col-12 col-xl-10">

      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-body p-4">
              <div class="row align-items-center">
                <div class="col-12 col-md-6">
                  <h2 class="mb-0 fw-bold text-primary" *ngIf="Request.ID==0">
                    <i class="pi pi-shopping-cart me-2"></i>
                    Create New Reservation
                  </h2>
                  <h2 class="mb-0 fw-bold text-primary" *ngIf="Request.ID>0">
                    <i class="pi pi-shopping-cart me-2"></i>
                    Reservation Details
                  </h2>
                </div>
                <div class="col-12 col-md-6 mt-3 mt-md-0">
                  <div class="form-floating">
                    <input type="text" [(ngModel)]="Request.ID" class="form-control" placeholder="Reservation Number" readonly>
                    <label class="text-muted">
                      <i class="pi pi-hashtag me-2"></i>Reservation Number
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Form -->
      <div class="row g-4">

        <!-- Right Section - Form Fields -->
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body p-4">

              <!-- Customer Selection -->
              <div class="row mb-4  my-4">
                <div class="col-12">
                  <div class="form-floating text-start">
                    <div class="text-end">
                      <p-button [raised]="true" [size]="'small'" (onClick)="AddCompany=true"  severity="info" label="Add Company" icon="pi pi-plus" class="btn-sm fw-bold"></p-button>
                    </div>
                    <app-comboBox [NormalStyle]="true" [dataSource]="Customers" optionValue="ID" optionLabel="NAME"
                      apiPathDataSource="Customer" [(SelectedValue)]="Request.CUSTOMER"
                      (SelectedValueChange)="onSelectCustomer()" class="form-control mt-2"></app-comboBox>
                    <label class="text-muted">
                      <i class="pi pi-user me-2"></i>Company
                    </label>
                  </div>
                </div>
              </div>
              <!-- Place  Selection -->
              <div class="row mb-4  my-4">
                <div class="col-12">
                  <div class="form-floating">
                    <app-comboBox [NormalStyle]="true" CashId="PLACE_REQUEST" [dataSource]="Places" optionValue="ID"
                      optionLabel="NAME" apiPathDataSource="Place" [(SelectedValue)]="Request.PLACE"
                      class="form-control "></app-comboBox>
                    <label class="text-muted">
                      Place
                    </label>

                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12 col-lg-6">
                  <!-- Date Fields -->
                  <div class="row mb-4 ">
                    <div class="col-12 ">
                      <div class="form-floating">
                        <app-DateTime [showTime]="true" [(selectedDate)]="Request.RESAVE_DATE"
                          class="form-control"></app-DateTime>
                        <label class="text-muted">
                          <i class="pi pi-calendar me-2"></i>Receipt Date
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <!-- customer name Fields -->
                  <div class="row mb-4 ">
                    <div class="col-12 ">
                      <div class="form-floating ">
                        <input type="text" [(ngModel)]="Request.CUSTOMER_BUY_NAME" class="form-control" />
                        <label class="text-muted">
                          Customer Name
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <!-- customer PHONE Fields -->
                  <div class="row mb-4 ">
                    <div class="col-12 ">
                      <div class="form-floating">
                        <input type="text" [(ngModel)]="Request.PHONE" class="form-control" />
                        <label class="text-muted">
                          Phone Number
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <!-- SELLER name Fields -->
                  <div class="row mb-4 ">
                    <div class="col-12 ">
                      <div class="form-floating">
                        <input type="text" [(ngModel)]="Request.SELLER" class="form-control" />
                        <label class="text-muted">
                          Sales Representative
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <!-- Payment & Discount Section -->
                  <div class="row mb-4">
                    <div class="col-12 mb-3 mb-md-0">
                      <div class="form-floating">
                        <p-inputNumber [(ngModel)]="Request.DEPOST" [minFractionDigits]="0" [maxFractionDigits]="3"
                          class="form-control" styleClass="w-100"></p-inputNumber>
                        <label class="text-muted">
                          <i class="pi pi-money-bill me-2"></i>Deposit
                        </label>
                      </div>
                    </div>
                    <div class="col-12" *ngIf="Request.DEPOST> 0">
                      <div class="form-floating">
                        <app-comboBox [NormalStyle]="true" [dataSource]="AccountTypes"
                          [(SelectedValue)]="Request.PAYMENT_TYPE" optionLabel="NAME" optionValue="ID"
                          placeholder="Payment Method" class="form-control"></app-comboBox>
                        <label class="text-muted">
                          <i class="pi pi-credit-card me-2"></i>Payment Method
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <div class="row mb-4">
                    <div class="col-12">
                      <div class="form-floating">
                        <p-inputNumber [(ngModel)]="Request.DESCOUND_PERCENT" [max]="100" [min]="0" class="form-control"
                          styleClass="w-100"></p-inputNumber>
                        <label class="text-muted">
                          <i class="pi pi-percentage me-2"></i>Discount Percentage
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <!-- Adress Card -->
                  <div class="col-12">
                    <div class="card shadow-sm border-0">
                      <div class="card-header bg-light border-0">
                        <h5 class="mb-0 fw-bold text-secondary">
                          <i class="pi pi-comment me-2"></i>Delivery Address
                        </h5>
                      </div>
                      <div class="card-body p-3">
                        <div class="form-floating">
                          <textarea [(ngModel)]="Request.ADDRESS" class="form-control"
                            style="height: 120px; resize: vertical;" placeholder="Write the address here..."></textarea>
                          <label class="text-muted">Write the address here...</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>









            </div>
          </div>
        </div>

        <!-- Left Section - Calculations & Notes -->
        <div class="col-12 col-lg-4">
          <div class="row g-3">

            <!-- Calculations Card -->
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-light border-0">
                  <h5 class="mb-0 fw-bold text-secondary">
                    <i class="pi pi-calculator me-2"></i>Calculations
                  </h5>
                </div>
                <div class="card-body p-3">
                  <div class="row g-3">
                    <div class="col-12">
                      <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                        <span class="text-muted">Reservation Price:</span>
                        <span class="fw-bold text-primary">{{Total()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                        <span class="text-muted">Discount Value:</span>
                        <span class="fw-bold text-warning">{{DescoundValue()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div
                        class="d-flex justify-content-between align-items-center p-3 bg-success bg-opacity-10 rounded border border-success border-opacity-25">
                        <span class="text-success">Price After Discount:</span>
                        <span class="fw-bold text-success">{{TotalAfterDescound()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div
                        class="d-flex justify-content-between align-items-center p-3 bg-info bg-opacity-10 rounded border border-info border-opacity-25">
                        <span class="text-info">Remaining After Deposit:</span>
                        <span class="fw-bold text-info">{{TotalAfterDepost()}}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <!-- Notes Card -->
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-light border-0">
                  <h5 class="mb-0 fw-bold text-secondary">
                    <i class="pi pi-comment me-2"></i>Notes
                  </h5>
                </div>
                <div class="card-body p-3">
                  <div class="form-floating">
                    <textarea [(ngModel)]="Request.NOTS" class="form-control" style="height: 120px; resize: vertical;"
                      placeholder="Write notes here..."></textarea>
                    <label class="text-muted">Write notes here...</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Items Section -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-light border-0">
              <h5 class="mb-0 fw-bold text-secondary">
                <i class="pi pi-list me-2"></i> Requested Items
              </h5>
            </div>
            <div class="card-body">
              <app-InputFastItems #InputFastItems [ITEMS_INPUT]="Request.ITEMS"
                (OnGridLoaded)="GridLoaded($event)"></app-InputFastItems>
            </div>
          </div>
        </div>
      </div>

      <!-- Save Button -->
      <div class="row my-4">
        <div class="col-12 ">
          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <p-button *ngIf=" this.Request.ID==0" [raised]="true" (onClick)="Save()" severity="success"
              label="Add Reservation & Print" icon="pi pi-save" class="btn-lg p-1 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Request.ID>0" [raised]="true" (onClick)="Save()" severity="success"
              label="Save Reservation Changes & Print" icon="pi pi-save" class="btn-lg p-1 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Request.ID>0" [raised]="true" (onClick)="PrintCleck()" severity="success"
              label="Print Reservation" icon="pi pi-print" class="btn-lg p-1 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Request.ID>0" [raised]="true" (onClick)="delete()" severity="danger"
              label="Delete Reservation" icon="pi pi-trash" class="btn-lg p-1 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Request.ID>0" [raised]="true" (onClick)="AddNew()" severity="info" label="New Reservation"
              icon="pi pi-plus" class="btn-lg p-1 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Request.ID>0" [raised]="true" (onClick)="AddInhert()" severity="info"
              label="New Reservation with Same Data" icon="pi pi-plus" severity="info"
              class="btn-lg p-1 fw-bold shadow-sm"></p-button>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>
<p-dialog header="Add New Company" [modal]="true" [style]="{'width':'50%'}" [(visible)]="AddCompany">
  <iframe  [src]="safeUrl" width="100%" 
      height="600px"></iframe>
</p-dialog>