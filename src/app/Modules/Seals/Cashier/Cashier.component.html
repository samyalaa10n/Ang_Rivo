<div class="row my-2">
  <div class="col-12 col-lg-4 p-1">
    <app-comboBox CashId="Acount_cash" placeholder="Select Restaurant Account" [dataSource]="Customers" optionValue="ID" optionLabel="NAME"
      [(SelectedValue)]="Invoice.CUSTOMER" class="form-control"></app-comboBox>
  </div>
  <div class="col-12 col-lg-4 p-1">
    <app-comboBox CashId="PLACE_REQUEST" placeholder="Select Location" [dataSource]="Places" optionValue="ID" optionLabel="NAME" apiPathDataSource="Place"
      (selectedChange)="getTabels($event)"></app-comboBox>
  </div>
  <div class="col-12 col-lg-4 p-1">
    <app-comboBox CashId="werhouse_cash" placeholder="Select Warehouse" [dataSource]="WareHouses" optionValue="ID" optionLabel="NAME"
      apiPathDataSource="WareHouse" [(SelectedValue)]="Invoice.WAREHOUSE" class="form-control"></app-comboBox>
  </div>
</div>

<div class="container">
  <!-- Tables Section -->
  <div class="tables-section" *ngIf="Invoice.WAREHOUSE!=0 && Invoice.CUSTOMER!=0">
    <h2>Select Table</h2>
    <div class="tables-grid">
      <button (click)="selectTable(PayDirect)" [class.Work]="PayDirect.itemsCared.length>0"
        [class.active]="selectedTable === PayDirect.id" class="table-btn" style="font-size: 14px; padding:0px;">
        Direct Sale
      </button>
      <button *ngFor="let table of tables" (click)="selectTable(table)" [class.Work]="table.itemsCared.length>0"
        [class.active]="selectedTable === table.id" class="table-btn">
        {{ table.id }}
      </button>

    </div>
    <div *ngIf="selectedTable" class="selected-table">
      ✓ Table: <strong>{{ selectedTable }}</strong>
    </div>
  </div>

  <!-- Menu Section -->
  <div class="menu-section" *ngIf="selectedTable>0 || selectedTable==-2">
    <h1>Menu</h1>

    <!-- Categories -->
    <div class="categories">
      <button *ngFor="let category of categories" (click)="selectCategory(category.id)"
        [class.active]="selectedCategory === category.id" class="category-btn">
        {{ category.name }}
      </button>
    </div>

    <!-- Items -->
    <div class="menu-grid">
      <button *ngFor="let item of getItemsByCategory()" (click)="addToCart(item)" class="menu-item">
        <div class="item-name">{{ item.name }} [ {{ item.UNIT }} ]</div>
        <div class="item-price">{{ item.price }} EGP</div>
      </button>
    </div>
  </div>

  <!-- Cashier Section -->
  <div class="cashier-section" *ngIf="selectedTable>0 || selectedTable==-2">
    <div class="cashier-header">
      <h2>Invoice</h2>
      <div class="order-number">Table #{{ selectedTable }}</div>
    </div>

    <!-- Cart Items -->
    <div class="cart-items">
      <div *ngIf="cart.length === 0" class="empty-cart">
        <p>No items selected</p>
      </div>
      <div *ngFor="let item of cart" class="cart-item">
        <div class="item-header">
          <div class="item-name">{{ item.name }}</div>
          <button (click)="removeFromCart(item.id)" class="delete-btn">
            ✕
          </button>
        </div>
        <div class="item-controls">
          <div class="price mx-2">Price</div>
          <input type="number" class="form-control form-input mx-1 d-inline " [(ngModel)]="item.price">
          <div class="price mx-2">EGP</div>
          <div class="quantity-control">
            <button (click)="updateQuantity(item.id, item.quantity - 1)" class="qty-btn">
              −
            </button>
            <span class="quantity">{{ item.quantity }}</span>
            <button (click)="updateQuantity(item.id, item.quantity + 1)" class="qty-btn">
              +
            </button>
          </div>
        </div>
        <div class="item-total">
          {{ item.price * item.quantity }} EGP
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="summary">
      <div class="summary-row">
        <span>Number of Items:</span>
        <span class="value">{{ totalItems }}</span>
      </div>
      <div class="summary-row">
        <span>Price:</span>
        <span class="value">{{ totalPrice }} EGP</span>
      </div>
      <div class="summary-row total">
        <span>Total:</span>
        <span class="value">{{ finalTotal }} EGP</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button (click)="clearCart()" class="btn btn-clear">
        Clear
      </button>
      <button (click)="openPaymentModal()" [disabled]="cart.length === 0 || !selectedTable" class="btn btn-payment">
        Pay
      </button>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<p-dialog [(visible)]="showPaymentModal" [maximizable]="true" [modal]="true" header="Payment"
  [style]="{'width':'70%','height':'90%'}">
  <div dir="ltr">
    <div class="modal-total">
      <div>Total Due:</div>
      <div class="total-amount">{{ TotalAfterDescound() }} EGP</div>
    </div>
    <div class="row my-1">


      <div class="col-12 col-lg-6">

        <!-- Payment Options -->
        <div class="payment-options" *ngFor="let type of AccountTypes">
          <label class="payment-option">
            <input type="radio" name="payment" [value]="type" [(ngModel)]="paymentMethod" class="radio-input" />
            <span>{{type.name}}</span>
          </label>
        </div>

        <!-- Paid Amount Input -->
        <div *ngIf="paymentMethod!=null" class="cash-input-section">
          <label>Amount:</label>
          <input type="number" [(ngModel)]="paidAmount" placeholder="Enter Amount" class="cash-input" />
          <div *ngIf="paidAmount && paidAmount > 0" class="change-info">
            <div>Total Due: {{ finalTotal }} EGP</div>
            <div>Discount Value: {{ DescoundValue() }} EGP</div>
            <div>Total After Discount: {{ TotalAfterDescound() }} EGP</div>
            <div>Paid: {{ paidAmount }} EGP</div>
            <div [class]="changeAmount >= 0 ? 'change-positive' : 'change-negative'">Change: {{ changeAmount }} EGP
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="row mb-4">
          <div class="col-12 col-md-6">
            <div class="form-floating p-2" dir="ltr">
              <p-inputNumber [(ngModel)]="Invoice.DESCOUND_PERCENT" (ngModelChange)="EditPaidAmount()" [max]="100"
                [min]="0" class="form-control" styleClass="w-100"></p-inputNumber>
              <label class="text-muted">
                <i class="pi pi-percentage me-2"></i>Discount %
              </label>
            </div>
          </div>
        </div>
        <!-- Buttons -->
        <div class="modal-buttons">
          <button *ngIf="paymentMethod!=null" (click)="completePayment()" class="btn btn-confirm">
            ✓ Confirm
          </button>
          <button (click)="closePaymentModal()" class="btn btn-cancel">
            Cancel
          </button>
        </div>
      </div>
    </div>



  </div>
</p-dialog>