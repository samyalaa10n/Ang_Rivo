<div dir="rtl">
  <p-button [raised]="true" [routerLink]="['/Main/InvoiceList']" routerLinkActive="router-link-active" severity="info"
    label="رجوع الي قائمة الفواتير" icon="pi pi-arrow-right" class=" btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
  <div class="row justify-content-center my-3">
    <div class="col-12 col-xl-10">

      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-body p-4">
              <div class="row align-items-center">
                <div class="col-12 col-md-6">
                  <h2 class="mb-0 fw-bold text-primary" *ngIf="Invoice.ID==0">
                    <i class="pi pi-shopping-cart me-2"></i>
                    إنشاء فاتورة جديدة
                  </h2>
                  <h2 class="mb-0 fw-bold text-primary" *ngIf="Invoice.ID>0">
                    <i class="pi pi-shopping-cart me-2"></i>
                    بيانات الفاتورة
                  </h2>
                </div>
                <div class="col-12 col-md-6 mt-3 mt-md-0">
                  <div class="form-floating">
                    <input type="text" [(ngModel)]="Invoice.ID" class="form-control" placeholder="رقم الفاتورة"
                      readonly>
                    <label class="text-muted">
                      <i class="pi pi-hashtag me-2"></i>رقم الفاتورة
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Form -->
      <div class="row g-4">

        <!-- Right Section - Form Fields -->
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body p-4">

              <!-- Type Selection -->
              <div class="row mb-4  my-4">
                <div class="col-12">
                  <div class="form-floating">
                    <app-comboBox [NormalStyle]="true" [dataSource]="[{ID:1,NAME:'بيع'},{ID:2,NAME:'ارتجاع'}]"
                      optionValue="ID" optionLabel="NAME" [(SelectedValue)]="Invoice.TYPE"
                      class="form-control"></app-comboBox>
                    <label class="text-muted">
                      <i class="pi pi-database me-2"></i>نوع العملية
                    </label>
                  </div>
                </div>
              </div>
              <!-- WareHouses add Selection -->
              <div class="row mb-4  my-4" *ngIf="Invoice.TYPE>0">
                <div class="col-12">
                  <div class="form-floating">
                    <app-comboBox [NormalStyle]="true" [dataSource]="WareHouses" optionValue="ID" optionLabel="NAME"
                      apiPathDataSource="WareHouse" [(SelectedValue)]="Invoice.WAREHOUSE" (SelectedValueChange)="GetDataRecordedStock()"
                      class="form-control"></app-comboBox>
                    <label class="text-muted">
                      <i class="pi pi-database me-2"></i>
                      <span *ngIf="Invoice.TYPE==1">من مخزن</span>
                      <span *ngIf="Invoice.TYPE==2">الي مخزن</span>
                    </label>
                  </div>
                </div>
              </div>
              <!-- Customer Selection -->
              <div class="row mb-4  my-4">
                <div class="col-12">
                  <div class="form-floating">
                    <app-comboBox [NormalStyle]="true" [dataSource]="Customers" optionValue="ID" optionLabel="NAME"
                      apiPathDataSource="Customer" [(SelectedValue)]="Invoice.CUSTOMER" (SelectedValueChange)="GetDataRecordedStock()"
                      class="form-control"></app-comboBox>
                    <label class="text-muted">
                      <i class="pi pi-user me-2"></i>العميل
                    </label>
                  </div>
                </div>
              </div>

              <!-- Date Fields -->
              <div class="row mb-4 ">
                <div class="col-12 col-md-6 ">
                  <div class="form-floating">
                    <app-DateTime [(selectedDate)]="Invoice.DATE_TIME" class="form-control"></app-DateTime>
                    <label class="text-muted">
                      <i class="pi pi-calendar me-2"></i>تاريخ الفاتورة
                    </label>
                  </div>
                </div>
              </div>

              <!-- Payment & Discount Section -->
              <div class="row mb-4">
                <div class="col-12 col-md-6 mb-3 mb-md-0">
                  <div class="form-floating">
                    <p-inputNumber [(ngModel)]="Invoice.PAYMENT" [minFractionDigits]="0" [maxFractionDigits]="3"
                      class="form-control" styleClass="w-100"></p-inputNumber>
                    <label class="text-muted">
                      <i class="pi pi-money-bill me-2"></i>المدفوع
                    </label>
                  </div>
                </div>
                <div class="col-12 col-md-6" *ngIf="Invoice.PAYMENT">
                  <div class="form-floating">
                    <app-comboBox [NormalStyle]="true"  [dataSource]="GetAccountTypesActive()"
                      [(SelectedValue)]="Invoice.PAYMENT_TYPE"  optionLabel="NAME" optionValue="ID"
                      placeholder="طريقة الدفع" class="form-control"></app-comboBox>
                    <label class="text-muted">
                      <i class="pi pi-credit-card me-2"></i>طريقة الدفع
                    </label>
                  </div>
                </div>
              </div>

              <div class="row mb-4">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <p-inputNumber [(ngModel)]="Invoice.DESCOUND_PERCENT" [max]="100" [min]="0" class="form-control"
                      styleClass="w-100"></p-inputNumber>
                    <label class="text-muted">
                      <i class="pi pi-percentage me-2"></i>نسبة خصم
                    </label>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Left Section - Calculations & Notes -->
        <div class="col-12 col-lg-4">
          <div class="row g-3">

            <!-- Calculations Card -->
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-light border-0">
                  <h5 class="mb-0 fw-bold text-secondary">
                    <i class="pi pi-calculator me-2"></i>الحسابات
                  </h5>
                </div>
                <div class="card-body p-3">
                  <div class="row g-3">
                    <div class="col-12">
                      <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                        <span class="text-muted">سعر الفاتورة:</span>
                        <span class="fw-bold text-primary">{{Total()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                        <span class="text-muted">قيمة الخصم:</span>
                        <span class="fw-bold text-warning">{{DescoundValue()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div
                        class="d-flex justify-content-between align-items-center p-3 bg-success bg-opacity-10 rounded border border-success border-opacity-25">
                        <span class="text-success">السعر بعد الخصم:</span>
                        <span class="fw-bold text-success">{{TotalAfterDescound()}}</span>
                      </div>
                    </div>
                    <div class="col-12">
                      <div
                        class="d-flex justify-content-between align-items-center p-3 bg-info bg-opacity-10 rounded border border-info border-opacity-25">
                        <span class="text-info">المتبقي بعد الدفع:</span>
                        <span class="fw-bold text-info">{{TotalAfterPayment()}}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Notes Card -->
            <div class="col-12">
              <div class="card shadow-sm border-0">
                <div class="card-header bg-light border-0">
                  <h5 class="mb-0 fw-bold text-secondary">
                    <i class="pi pi-comment me-2"></i>الملاحظات
                  </h5>
                </div>
                <div class="card-body p-3">
                  <div class="form-floating">
                    <textarea [(ngModel)]="Invoice.NOTS" class="form-control" style="height: 120px; resize: vertical;"
                      placeholder="اكتب الملاحظات هنا..."></textarea>
                    <label class="text-muted">اكتب الملاحظات هنا...</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Items Section -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-light border-0">
              <h5 class="mb-0 fw-bold text-secondary">
                <i class="pi pi-list me-2"></i>اصناف الفاتورة
              </h5>
            </div>
            <div class="card-body">
              <app-InputFastItems Header="اصناف الفاتورة" #InputFastItems 
                (OnGridLoaded)="GridLoaded($event)"></app-InputFastItems>
            </div>
          </div>
        </div>
      </div>

      <!-- Save Button -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="d-grid gap-2 d-md-flex justify-content-md-center">
            <p-button *ngIf=" this.Invoice.ID==0" [raised]="true" (onClick)="Save()" severity="success"
              label="اضافة فاتورة وطباعة" icon="pi pi-save" class="btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Invoice.ID>0" [raised]="true" (onClick)="Save()" severity="success"
              label="حفظ تعديل الفاتورة وطباعة" icon="pi pi-save" class="btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Invoice.ID>0" [raised]="true" (onClick)="delete()" severity="danger"
              label="حذف الفاتورة" icon="pi pi-trash" class="btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Invoice.ID>0" [raised]="true" (onClick)="AddNew()" severity="info"
              label="فاتورة جديدة" icon="pi pi-plus" class="btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
            <p-button *ngIf=" this.Invoice.ID>0" [raised]="true" (onClick)="AddInhert()" severity="info"
              label="فاتورة جديدة بنفس البيانات" icon="pi pi-plus" severity="info"
              class="btn-lg px-5 py-3 fw-bold shadow-sm"></p-button>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>